<html>
<head>
    <title>Draft of Event Plan Template</title>
    <meta name="decorator" content="atl.admin">
    <meta name="admin.active.section" content="admin_project_menu/project_section"/>
    <meta name="admin.active.tab" content="event_plans"/>
    $webResourceManager.requireResource("edu.uz.jira.event.planner.event-planner:event-plans-configuration-resources")
</head>
<body>
<header class="aui-page-header">
    <div class="aui-page-header-inner">
        <div class="aui-page-header-main" id="page-title">
            <h2>Event Plan Template Configuration</h2>
        </div>
        <div class="aui-page-header-actions">
            <div id="category-form-buttons" class="aui-buttons" style="float: right;">
                <button id="event-category-dialog-next-button" class="aui-button aui-button-primary" resolved>Next
                </button>
                <button id="event-category-dialog-cancel-button" class="aui-button aui-button-link" resolved>Cancel
                </button>
            </div>

            <div id="all-components-form-buttons" class="aui-buttons" style="float: right;">
                <button id="event-all-components-dialog-back-button" class="aui-button" resolved>Back</button>
                <button id="event-all-components-dialog-create-button" class="aui-button" resolved><span
                        class="aui-icon aui-icon-small aui-iconfont-add"></span> Add Component
                </button>
                <button id="event-all-components-dialog-summary-button" class="aui-button aui-button-primary" resolved>
                    Summary
                </button>
                <button id="event-all-components-dialog-cancel-button" class="aui-button aui-button-link" resolved>
                    Cancel
                </button>
            </div>

            <div id="component-form-buttons" class="aui-buttons" style="float: right;">
                <button id="event-component-dialog-back-button" class="aui-button" resolved>Back</button>
                <button id="event-component-dialog-create-button" class="aui-button" resolved><span
                        class="aui-icon aui-icon-small aui-iconfont-add"></span> Add Component
                </button>
                <button id="event-component-dialog-create-task-button" class="aui-button" resolved><span
                        class="aui-icon aui-icon-small aui-iconfont-add"></span> Add Task
                </button>
                <button id="event-component-dialog-summary-button" class="aui-button aui-button-primary" resolved>
                    Summary
                </button>
                <button id="event-component-dialog-cancel-button" class="aui-button aui-button-link" resolved>Cancel
                </button>
            </div>

            <div id="task-form-buttons" class="aui-buttons" style="float: right;">
                <button id="event-task-dialog-back-button" class="aui-button" resolved>Back</button>
                <button id="event-task-dialog-create-component-button" class="aui-button" resolved><span
                        class="aui-icon aui-icon-small aui-iconfont-add"></span> Add Component
                </button>
                <button id="event-task-dialog-create-task-button" class="aui-button" resolved><span
                        class="aui-icon aui-icon-small aui-iconfont-add"></span> Add Task
                </button>
                <button id="event-task-dialog-summary-button" class="aui-button aui-button-primary" resolved>Summary
                </button>
                <button id="event-task-dialog-cancel-button" class="aui-button aui-button-link" resolved>Cancel
                </button>
            </div>

            <div id="plan-form-buttons" class="aui-buttons" style="float: right;">
                <button id="event-plan-dialog-back-button" class="aui-button" resolved>Back</button>
                <button id="event-plan-dialog-create-component-button" class="aui-button" resolved><span
                        class="aui-icon aui-icon-small aui-iconfont-add"></span> Add Component
                </button>
                <button id="event-plan-dialog-save-button" class="aui-button aui-button-primary" resolved>Save
                </button>
                <button id="event-plan-dialog-cancel-button" class="aui-button aui-button-link" resolved>Cancel
                </button>
            </div>
        </div>
    </div>
</header>

<p>This is configuration page for draft of Event Plan Template named <b id="plan-name-title"></b>.</p>
<br/>
<div id="category-form">
    <p>Drag&drop Event Categories which fits to this Event Plan Template</p>
    <table class="aui" style="height: 170px;">
        <thead>
        <tr>
            <th id="available-category-head">Available Categories</th>
            <th id="selected-category-head">Selected Categories for this Event Plan Template</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td headers="available-category-head" width="50%">
                <ul id="available-category" class="connectedSortable"></ul>
            </td>
            <td headers="selected-category-head" width="50%">
                <ul id="selected-category" class="connectedSortable"></ul>
            </td>
        </tr>
        </tbody>
    </table>
    <form class="aui" id="event-category-configuration" style="clear:both;">
        <div class="field-group">
            <label for="category-name">Name<span
                    class="aui-icon icon-required">(required)</span></label>
            <input id="category-name" class="text" name="category-name" type="text"
                   maxlength="80"
                   required>

            <div class="description" id="category-name-description">Max. 80 characters.</div>
        </div>

        <div class="buttons-container">
            <div class="buttons">
                <button id="event-category-dialog-add-button" class="aui-button"
                        title="Add new Category">
                    <span class="aui-icon aui-icon-small aui-iconfont-add"></span>
                    Add new Event Category
                </button>
            </div>
        </div>
    </form>
</div>

<div id="all-components-form">
    <p>Drag&drop Event Components which fits to this Event Plan Template</p>
    <table class="aui" style="height: 250px;">
        <thead>
        <tr>
            <th id="available-all-components-head">Available</th>
            <th id="selected-all-components-head">Selected</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td headers="available-all-components-head" width="50%">
                <ul id="available-all-components" class="connectedSortable"></ul>
            </td>
            <td headers="selected-all-components-head" width="50%">
                <ul id="selected-all-components" class="connectedSortable"></ul>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<div id="component-form">
    <div>
        <table class="aui" style="height: 170px;">
            <thead>
            <tr>
                <th id="available-task-head">Available Tasks Templates to drop into Component Template</th>
                <th id="component-template-head">New Component Template</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td headers="available-task-head" width="50%">
                    <ul id="available-task" class="connectedSortable"></ul>
                </td>
                <td headers="component-template-head" width="50%">
                    <div class="gadget color1 event-plan-element-portlet" style="position: relative;">
                        <div class="dashboard-item-frame gadget-container">
                            <div class="dashboard-item-header event-plan-element-portlet-content"><input
                                    id="component-name"
                                    class="text long-field"
                                    name="component-name"
                                    type="text" maxlength="80"
                                    placeholder="Name (max. 80 characters)"
                                    style="width:90%; margin: 2px;" required>
                            </div>
                            <div class="dashboard-item-content event-plan-element-portlet-content"
                                 style="overflow: hidden;">
                                                <textarea id="component-description" class="text text long-field"
                                                          name="component-description"
                                                          type="text"
                                                          placeholder="Description (max. 255 characters)"
                                                          maxlength="255"
                                                          style="width:90%; margin: 2px; resize: vertical; max-height: 150px;"></textarea>
                                <br/>Tasks:
                                <ul id="component-tasks" class="connectedSortable" style="min-height: 50px;"></ul>
                                <p>Estimated time to complete: </p>
                                <p class="aui-buttons" style="float: right;">
                                    <button id="event-component-dialog-clear-button"
                                            class="aui-button"
                                            title="Clear new Event Plan Component Template"
                                            resolved>Clear
                                    </button>
                                    <button id="event-component-dialog-add-button"
                                            class="aui-button aui-button-primary"
                                            title="Create new Event Plan Component Template"
                                            type="submit" resolved><span
                                            class="aui-icon aui-icon-small aui-iconfont-add"></span> Add
                                    </button>
                                </p>
                            </div>
                        </div>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
        <br/>
        <table class="aui" style="height: 250px; max-height: 250px; overflowY: scroll;">
            <thead>
            <tr>
                <th id="selected-component-head">Currently selected Component Templates</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td headers="selected-component-head">
                    <ul id="selected-component" class="connectedSortable"></ul>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<div id="task-form">
    <h3>Create new Task Template</h3>

    <form class="aui" id="event-task-configuration" style="clear:both;">
        <div class="field-group">
            <label for="task-name">Name<span
                    class="aui-icon icon-required">(required)</span></label>
            <input id="task-name" class="text" name="task-name" type="text" maxlength="80"
                   required>
            <div class="description" id="task-name-description">Max. 80 characters.</div>
        </div>
        <div class="field-group">
            <label for="task-description">Description</label>
            <input id="task-description" class="text" name="task-description" type="text"
                   maxlength="255">
            <div class="description" id="task-description-description">Max. 255 characters.</div>
        </div>
        <div class="field-group">
            <label for="task-needed-months">Time to complete<span
                    class="aui-icon icon-required">(required)</span></label>
            <input id="task-needed-months" class="text short-field" name="task-description"
                   type="number" min="0"
                   placeholder="Months" required> month(s) and
            <input id="task-needed-days" class="text short-field" name="task-description" type="number"
                   min="0"
                   placeholder="Days" required> day(s)
            <div class="description" id="task-needed-months-description">Number of months and days
                <u>before the event deadline</u> when this Task should be done.
            </div>
        </div>
        <div class="field-group" id="subtask-form">
            <label for="subtasks-table">SubTasks</label>

            <table class="aui" id="subtasks-table">
                <tbody>
                <tr>
                    <td width="50%">
                        <ul id="subtasks"></ul>
                    </td>
                    <td>
                        <form class="aui" id="event-subtask-configuration">
                            <div class="field-group">
                                <label for="subtask-name">Name<span
                                        class="aui-icon icon-required">(required)</span></label>
                                <input id="subtask-name" class="text" name="subtask-name"
                                       type="text" maxlength="80"
                                       required>
                                <div class="description" id="subtask-name-description">Max. 80
                                    characters.
                                </div>
                            </div>
                            <div class="field-group">
                                <label for="subtask-description">Description</label>
                                <input id="subtask-description" class="text"
                                       name="subtask-description" type="text"
                                       maxlength="255">
                                <div class="description" id="subtask-description-description">Max. 255
                                    characters.
                                </div>
                            </div>
                            <div class="buttons-container">
                                <div class="buttons">
                                    <button id="event-subtask-dialog-add-button"
                                            class="aui-button"
                                            title="Add SubTask Template">
                                        <span class="aui-icon aui-icon-small aui-iconfont-add"></span>
                                        Add new SubTask Template
                                    </button>
                                </div>
                            </div>
                        </form>
                    </td>
                </tr>
                </tbody>
            </table>
            <div class="description" id="subtask-description">Checklist of issues that should be
                completed with this Task Template.
            </div>
        </div>

        <div class="buttons-container">
            <div class="buttons">
                <button id="event-task-dialog-add-button" class="aui-button aui-button-primary"
                        title="Add new Task Template">
                    <span class="aui-icon aui-icon-small aui-iconfont-add"></span>
                    Add Task Template
                </button>
            </div>
        </div>
    </form>
    <br/>
    <table class="aui" style="height: 250px; max-height: 250px; overflowY: scroll;">
        <thead>
        <tr>
            <th id="available-tasks-head">Available Tasks Templates</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td headers="available-tasks-head">
                <ul id="available-tasks"
                    style="height: 250px; max-height: 250px; overflow-y: auto; overflow-x: auto;"></ul>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<div id="plan-form">
    <table class="aui" style="height: 250px;">
        <thead>
        <tr>
            <th id="selected-categories-head">Selected Categories</th>
            <th id="selected-components-head">Selected Components</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td headers="selected-categories-head" width="50%">
                <ul id="selected-categories" class="connectedSortable"></ul>
            </td>
            <td headers="selected-components-head" width="50%">
                <ul id="selected-components" class="connectedSortable"></ul>
            </td>
        </tr>
        </tbody>
    </table>
    <form class="aui" id="event-plan-configuration" style="clear:both;" action="">
        <div class="field-group">
            <label for="plan-name">Name<span
                    class="aui-icon icon-required">(required)</span></label>
            <input id="plan-name" class="text" name="plan-name" type="text"
                   maxlength="80"
                   required>

            <div class="description" id="plan-name-description">Max. 80 characters.</div>
        </div>

        <div class="field-group">
            <label for="plan-description">Description</label>
            <input id="plan-description" class="text" name="plan-description" type="text"
                   maxlength="80"
                   required>

            <div class="description" id="plan-description-description">Max. 80 characters.</div>
        </div>

        <div class="field-group">
            <label for="plan-reserve-months">Time reserve</label>
            <input id="plan-reserve-months" class="text short-field" name="plan-reserve-months"
                   type="number" min="0"
                   placeholder="Months"> month(s) and
            <input id="plan-reserve-days" class="text short-field" name="plan-reserve-days" type="number"
                   min="0"
                   placeholder="Days"> day(s)

            <div class="description" id="plan-reserve-description">Extra time for complete Event Plan.</div>
        </div>
    </form>
</div>

<script type="text/javascript">
    function getParameterByName(name) {
        name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
                results = regex.exec(location.search);
        return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
    }

    var plan = new Plan();
    var eventCategory = new Category();
    var allComponents = new Component();
    allComponents.id = 'all-components';
    var component = new Component();
    var task = new Task();
    var subTask = new SubTask();

    var categoryListener = new ButtonListener(eventCategory);
    categoryListener.onClickHideForm('next');
    categoryListener.onClickToggleResourceForm('next', allComponents);
    categoryListener.onClickAddAppendNewResourceToList(AJS.$("#selected-" + eventCategory.id));
    categoryListener.onCancelBackToEventPlanTemplatesList();

    var allComponentsListener = new ButtonListener(allComponents);
    allComponentsListener.hideForm();
    allComponentsListener.onClickHideForm('summary');
    allComponentsListener.onClickToggleResourceForm('summary', plan);
    allComponentsListener.onClickMoveListsElements('summary', '#selected-' + allComponents.id, '#selected-components');
    allComponentsListener.onClickMoveListsElements('summary', '#selected-' + eventCategory.id, '#selected-categories');
    allComponentsListener.onClickHideForm('back');
    allComponentsListener.onClickToggleResourceForm('back', eventCategory);
    allComponentsListener.onClickHideForm('create');
    allComponentsListener.onClickToggleResourceForm('create', component);
    allComponentsListener.onClickMoveListsElements('create', '#selected-' + allComponents.id, '#selected-' + component.id);
    allComponentsListener.onCancelBackToEventPlanTemplatesList();

    var componentListener = new ButtonListener(component);
    componentListener.hideForm();
    componentListener.onClickHideForm('summary');
    componentListener.onClickToggleResourceForm('summary', plan);
    componentListener.onClickMoveListsElements('summary', '#selected-' + allComponents.id, '#selected-components');
    componentListener.onClickMoveListsElements('summary', '#selected-' + eventCategory.id, '#selected-categories');
    componentListener.onClickHideForm('back');
    componentListener.onClickHideForm('create-task');
    componentListener.onClickClearForm('create-component');
    componentListener.onClickClearForm('clear');
    componentListener.onClickToggleResourceForm('back', allComponents);
    componentListener.onClickMoveListsElements('back', '#selected-' + component.id, '#selected-' + allComponents.id);
    componentListener.onClickToggleResourceForm('create-task', task);
    componentListener.onClickMoveListsElements('create-task', '#available-' + task.id, '#available-tasks');
    componentListener.onCancelBackToEventPlanTemplatesList();
    componentListener.onClickAddAppendNewResourceToList(AJS.$("#selected-" + component.id));

    var taskListener = new ButtonListener(task);
    taskListener.hideForm();
    taskListener.onClickHideForm('summary');
    taskListener.onClickToggleResourceForm('summary', plan);
    taskListener.onClickMoveListsElements('summary', '#selected-' + allComponents.id, '#selected-components');
    taskListener.onClickMoveListsElements('summary', '#selected-' + eventCategory.id, '#selected-categories');
    taskListener.onClickClearForm('create-task');
    taskListener.onClickHideForm('create-component');
    taskListener.onClickToggleResourceForm('create-component', component);
    taskListener.onClickMoveListsElements('create-component', '#available-tasks', '#available-' + task.id);
    taskListener.onClickHideForm('back');
    taskListener.onClickToggleResourceForm('back', component);
    taskListener.onClickMoveListsElements('back', '#available-tasks', '#available-' + task.id);
    taskListener.onCancelBackToEventPlanTemplatesList();
    taskListener.onClickAddAppendNewResourceToList(AJS.$("#available-tasks"));

    var subTaskListener = new ButtonListener(subTask);
    subTaskListener.onClickAddAppendNewResourceToList(AJS.$("#subtasks"));

    var planListener = new ButtonListener(plan);
    planListener.hideForm();
    planListener.onClickHideForm('back');
    planListener.onClickToggleResourceForm('back', allComponents);
    planListener.onClickMoveListsElements('back', '#selected-components', '#selected-' + allComponents.id);
    planListener.onClickMoveListsElements('back', '#selected-categories', '#selected-' + eventCategory.id);
    planListener.onClickHideForm('create-component');
    planListener.onClickToggleResourceForm('create-component', component);
    planListener.onClickMoveListsElements('create-component', '#selected-components', '#selected-' + component.id);
    planListener.onClickMoveListsElements('create-component', '#selected-categories', '#selected-' + eventCategory.id);
    planListener.onCancelBackToEventPlanTemplatesList();
    planListener.onClick('save', function () {
        alert('save!');
    });

    AJS.$(document).ready(
            function () {
                var planName = getParameterByName('plan-name'), planDescription = getParameterByName('plan-description');
                jQuery('#plan-name-title').append(planName);
                jQuery('#plan-name').append(planName);
                jQuery('#plan-description').append(planDescription);

                var rest = new RESTManager();
                rest.doGetResourcesInto([eventCategory], eventCategory);
                rest.doGetResourcesInto([component], allComponents);
                rest.doGetResourcesInto([task], task);
            }
    );

    jQuery("ul.connectedSortable").sortable({
        connectWith: "ul",
        dropOnEmpty: true,
        cursor: "move"
    }).disableSelection();

    jQuery("#available-" + task.id).sortable({
        connectWith: ".connectedSortable",
        remove: function (event, ui) {
            var itemClone, destinationListId;
            destinationListId = '#component-tasks';
            itemClone = ui.item.clone();

            itemClone.appendTo(destinationListId);
            jQuery(this).sortable('cancel');
        }
    }).disableSelection();
</script>
</body>
</html>
