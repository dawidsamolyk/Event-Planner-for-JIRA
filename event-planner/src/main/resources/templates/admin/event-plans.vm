<html>
<head>
    <title>Event Organization Plans Configurations</title>
    <meta name="decorator" content="atl.admin">
    <meta name="admin.active.section" content="admin_project_menu/project_section"/>
    <meta name="admin.active.tab" content="event_plans"/>
    <script src="//aui-cdn.atlassian.com/aui-adg/5.9.3/js/aui.js"></script>
    <script src="//aui-cdn.atlassian.com/aui-adg/5.9.3/js/aui-experimental.js"></script>
    <script src="//aui-cdn.atlassian.com/aui-adg/5.9.3/js/aui-datepicker.js"></script>
    <link rel="stylesheet" type="text/css" href="//aui-cdn.atlassian.com/aui-adg/5.9.3/css/aui.css"/>
    <link rel="stylesheet" type="text/css" href="//aui-cdn.atlassian.com/aui-adg/5.9.3/css/aui-experimental.css"/>
</head>
<body>
<section class="aui-page-panel-content">
    <header class="aui-page-header">
        <div class="aui-page-header-inner">
            <div class="aui-page-header-main">
                <h2>View Event Organization Plans</h2>
            </div>
            <div class="aui-page-header-actions">
                <div class="aui-buttons">
                    <button id="add-plan-button" class="aui-button trigger-dialog">
                        <span class="aui-icon aui-icon-small aui-iconfont-add"></span>
                        Add Event Organization Plan
                    </button>
                </div>

                <span class="aui-icon aui-icon-small aui-iconfont-help">Get help!</span>
            </div>
        </div>
    </header>

    <div class="aui-message info">
        <span class="aui-icon icon-info"></span>

        <p>Opis...</p>
    </div>

    <table id="plans-table" class="aui aui-table-rowhover">
        <thead>
        <tr>
            <th>
                Name
            </th>
            <th>
                Description
            </th>
            <th>
                Domains
            </th>
            <th>
                Components
            </th>
            <th>
                Time to complete
            </th>
            <th>
                Operations
            </th>
        </tr>
        </thead>
        <tbody>
        #foreach($eachPlan in $PLANS)
        <tr>
            <td>
                    <span data-scheme-field="name" class="field-name">
                        <a href="/jira/secure/" title="Edit Event Organization Plan properties">$eachPlan.getName()</a>
                    </span>
            </td>
            <td>
                $eachPlan.getDescription()
            </td>
            <td>
                <ul>
                    #foreach($eachDomain in $eachPlan.getDomains())
                    <li><a href="/jira/secure/" title="See Event Organization domains">$eachDomain.getName()</a></li>
                    #end
                </ul>
            </td>
            <td>
                <ul>
                    #foreach($eachComponent in $eachPlan.getComponents())
                    <li><a href="/jira/secure/" title="See Event Organization domains">$eachComponent.getName()</a></li>
                    #end
                </ul>
            </td>
            <td>
                $eachPlan.getTimeToComplete()
            </td>
            <td>
                <ul class="operations-list">
                    <li>
                        <a id="configure"
                           href="/jira/secure/admin/ViewIssueFields.jspa"
                           title="Configure Event Organization Plan">Edit</a>
                    </li>
                    <li>
                        <a id="copy"
                           href="/jira/secure/admin/CopyFieldLayout!default.jspa?id=10000"
                           title="Copy Event Organization Plan">Copy</a>
                    </li>
                    <li>
                        <a id="delete"
                           href="/jira/secure/admin/ViewIssueFields.jspa"
                           title="Delete Event Organization Plan">Delete</a>
                    </li>
                </ul>
            </td>
        </tr>
        #end
        </tbody>
    </table>
</section>

<section role="dialog" id="event-plan-dialog" class="aui-layer aui-dialog2 aui-dialog2-medium" aria-hidden="true">
    <header class="aui-dialog2-header">
        <h2 class="aui-dialog2-header-main">Event Organization Plan Configuration</h2>
    </header>
    <div class="aui-dialog2-content">
        <form class="aui" id="event-plan-configuration" action="#" method="post">
            <div class="field-group" id="event-name-group">
                <label for="plan-name">Name<span class="aui-icon icon-required">(required)</span></label>
                <input id="plan-name" name="plan-name" type="text">

                <div class="description" id="plan-name-description">Name of the plan.</div>
            </div>
            <div class="field-group" id="event-description-group">
                <label for="plan-description">Description</label>
                <input id="plan-description" name="plan-description" type="text">

                <div class="description" id="plan-description-description">Description of the plan.</div>
            </div>
            <div class="field-group" id="event-time-group">
                <label for="plan-time">Time to completion
                    <span class="aui-icon icon-required">(required)</span></label>
                <input id="plan-time" name="plan-time" type="text">

                <div class="description" id="plan-time-description">Estimated time for event organization.</div>
            </div>
            <div class="field-group">
                <label for="plan-domains">Domains<span
                        class="aui-icon icon-required">(required)</span></label>
                <select class="multi-select" multiple="multiple" size="$DOMAINS.size()" id="plan-domains"
                        name="plan-domains" title="Domain">
                    #foreach($eachDomain in $DOMAINS)
                    <option>$eachDomain.getName()</option>
                    #end
                </select>

                <div class="aui-buttons">
                    <button id="add-domains" class="aui-button trigger-dialog">
                        <span class="aui-icon aui-icon-small aui-iconfont-add"></span>
                        Add new Domain
                    </button>
                </div>

                <div class="description" id="plan-domains-description">Event domains.</div>
            </div>
            <div class="field-group">
                <label for="plan-components">Components<span
                        class="aui-icon icon-required">(required)</span></label>
                <select class="multi-select" multiple="multiple" size="$COMPONENTS.size()" id="plan-components"
                        name="plan-components" title="Components">
                    #foreach($eachComponent in $COMPONENTS)
                    <option>$eachComponent.getName()</option>
                    #end
                </select>

                <div class="aui-buttons">
                    <button id="add-component" class="aui-button trigger-dialog">
                        <span class="aui-icon aui-icon-small aui-iconfont-add"></span>
                        Add new Component
                    </button>
                </div>

                <div class="description" id="plan-components-description">Elements of an event.</div>
            </div>
        </form>
    </div>
    <footer class="aui-dialog2-footer">
        <div class="aui-dialog2-footer-actions">
            <button id="event-plan-dialog-cancel-button" class="aui-button">Cancel</button>
            <button id="event-plan-dialog-save-button" class="aui-button aui-button-primary" type="submit">Save</button>
        </div>
    </footer>
</section>

<section role="dialog" id="event-domains-dialog" class="aui-layer aui-dialog2 aui-dialog2-medium" aria-hidden="true">
    <header class="aui-dialog2-header">
        <h2 class="aui-dialog2-header-main">Event Domain Configuration</h2>
    </header>
    <div class="aui-dialog2-content">
        <form class="aui" id="event-domains-configuration" action="#" method="post">
            <div class="field-group" id="domains-name-group">
                <label for="domains-name">Name<span class="aui-icon icon-required">(required)</span></label>
                <input id="domains-name" name="domains-name" type="text">

                <div class="description" id="domains-name-description">Name of the Domain.</div>
            </div>
            <div class="field-group" id="domains-description-group">
                <label for="domains-description">Description</label>
                <input id="domains-description" name="domains-description" type="text">

                <div class="description" id="domains-description-description">Description of the Domain.</div>
            </div>
        </form>
    </div>
    <footer class="aui-dialog2-footer">
        <div class="aui-dialog2-footer-actions">
            <button id="event-domains-dialog-cancel-button" class="aui-button">Cancel</button>
            <button id="event-domains-dialog-save-button" class="aui-button aui-button-primary" type="submit">Save
            </button>
        </div>
    </footer>
</section>

<section role="dialog" id="event-component-dialog" class="aui-layer aui-dialog2 aui-dialog2-medium" aria-hidden="true">
    <header class="aui-dialog2-header">
        <h2 class="aui-dialog2-header-main">Event Component Configuration</h2>
    </header>
    <div class="aui-dialog2-content">
        <form class="aui" id="event-component-configuration" action="#" method="post">
            <div class="field-group" id="component-name-group">
                <label for="component-name">Name<span class="aui-icon icon-required">(required)</span></label>
                <input id="component-name" name="component-name" type="text">

                <div class="description" id="component-name-description">Name of the Component.</div>
            </div>
            <div class="field-group" id="component-description-group">
                <label for="component-description">Description</label>
                <input id="component-description" name="component-description" type="text">

                <div class="description" id="component-description-description">Description of the Component.</div>
            </div>
            <div class="field-group">
                <label for="component-tasks">Tasks<span
                        class="aui-icon icon-required">(required)</span></label>
                <select class="multi-select" multiple="multiple" size="$COMPONENTS.size()" id="component-tasks"
                        name="component-tasks" title="Tasks">
                    #foreach($eachTask in $TASKS)
                    <option>$eachTask.getName()</option>
                    #end
                </select>

                <div class="aui-buttons">
                    <button id="add-task" class="aui-button trigger-dialog">
                        <span class="aui-icon aui-icon-small aui-iconfont-add"></span>
                        Add new Task
                    </button>
                </div>

                <div class="description" id="component-tasks-description">Tasks to do for complete event component.
                </div>
            </div>
        </form>
    </div>
    <footer class="aui-dialog2-footer">
        <div class="aui-dialog2-footer-actions">
            <button id="event-component-dialog-cancel-button" class="aui-button">Cancel</button>
            <button id="event-component-dialog-save-button" class="aui-button aui-button-primary" type="submit">Save
            </button>
        </div>
    </footer>
</section>

<section role="dialog" id="event-task-dialog" class="aui-layer aui-dialog2 aui-dialog2-medium" aria-hidden="true">
    <header class="aui-dialog2-header">
        <h2 class="aui-dialog2-header-main">Task definition</h2>
    </header>
    <div class="aui-dialog2-content">
        <form class="aui" id="event-task-configuration" action="#" method="post">
            <div class="field-group" id="task-name-group">
                <label for="task-name">Name<span class="aui-icon icon-required">(required)</span></label>
                <input id="task-name" name="task-name" type="text">

                <div class="description" id="task-name-description">Name of the Task.</div>
            </div>
            <div class="field-group" id="task-description-group">
                <label for="task-description">Description</label>
                <input id="task-description" name="task-description" type="text">

                <div class="description" id="task-description-description">Description of the Task.</div>
            </div>
            <div class="field-group" id="task-time-group">
                <label for="task-time">Time to complete<span
                        class="aui-icon icon-required">(required)</span></label>
                <input id="task-time" name="task-time" type="text">

                <div class="description" id="task-time-description">Estimated time to complete Task.
                </div>
            </div>
            <div class="field-group">
                <label for="task-subtasks">SubTasks</label>
                <select class="multi-select" multiple="multiple" size="$SUBTASKS.size()" id="task-subtasks"
                        name="task-subtasks" title="Sub-Tasks">
                    #foreach($eachTask in $SUBTASKS)
                        <option>$eachTask.getName()</option>
                    #end
                </select>

                <div class="aui-buttons">
                    <button id="add-subtask" class="aui-button trigger-dialog">
                        <span class="aui-icon aui-icon-small aui-iconfont-add"></span>
                        Add new Sub-Task
                    </button>
                </div>

                <div class="description" id="task-subtasks-description">Sub-Tasks to do for complete this Task.
                </div>
            </div>
        </form>
    </div>
    <footer class="aui-dialog2-footer">
        <div class="aui-dialog2-footer-actions">
            <button id="event-task-dialog-cancel-button" class="aui-button">Cancel</button>
            <button id="event-task-dialog-save-button" class="aui-button aui-button-primary" type="submit">Save
            </button>
        </div>
    </footer>
</section>

<script type="text/javascript">
        AJS.$("#add-plan-button").click(function(e) {
            e.preventDefault();

            document.getElementById("plan-name").value = "";
            document.getElementById("plan-description").value = "";
            document.getElementById("plan-time").value = "";
            document.getElementById("plan-domains").value = "";
            document.getElementById("plan-components").value = "";

            AJS.dialog2("#event-plan-dialog").show();
        });

        function saveEventPlan() {
            var url = AJS.contextPath() + "/rest/event-plans/1.0/plan";

            jQuery.ajax({
                url: url,
                type: "PUT",
                contentType: "application/json",
                data:     '{ "name": "'         + AJS.$("#plan-name").attr("value") +
                         '", "description": "'  + AJS.$("#plan-description").attr("value") +
                         '", "time": "'         + AJS.$("#plan-time").attr("value") +
                         '", "domains": '       + JSON.stringify(AJS.$("#plan-domains").val()) +
                          ', "components": '    + JSON.stringify(AJS.$("#plan-components").val()) + ' }',
                processData: false
            });

            // wstaw GET
        }

        AJS.$("#event-plan-dialog-save-button").click(function(e) {
            e.preventDefault();

            var planName = document.getElementById("plan-name").value;
            var planTime = document.getElementById("plan-time").value;
            var domains = document.getElementById("plan-domains").value;
            var components = document.getElementById("plan-components").value;
            var valid = true;

            if(planName.valueOf() == "".valueOf()) {
                AJS.$('#plan-name-description').html('<div class="error" data-field="plan-name">You must specify a name of event Plan.</div>');
                valid = false;
            }
            if(planTime.valueOf() == "".valueOf()) {
                AJS.$('#plan-time-description').html('<div class="error" data-field="plan-time">You must specify estimated tine for this kind of event Plan.</div>');
                valid = false;
            }
            if(domains.valueOf() == "".valueOf()) {
                AJS.$('#plan-domains-description').html('<div class="error" data-field="plan-domains">You must select at least one Domain of event Plan.</div>');
                valid = false;
            }
            if(components.valueOf() == "".valueOf()) {
                AJS.$('#plan-components-description').html('<div class="error" data-field="plan-components">You must select at least one Component of event Plan.</div>');
                valid = false;
            }

            if(valid) {
                // TODO Sprawdź czy obiekt Plan o tej nazwie już istnieje
                saveEventPlan();

                AJS.dialog2("#event-plan-dialog").hide();
            }
        });

        AJS.$("#event-plan-dialog-cancel-button").click(function(e) {
            e.preventDefault();
            AJS.dialog2("#event-plan-dialog").hide();
            AJS.dialog2("#event-component-dialog").hide();
            AJS.dialog2("#event-domains-dialog").hide();
        });

        AJS.$("#add-domains").click(function(e) {
            e.preventDefault();

            document.getElementById("domains-name").value = "";
            document.getElementById("domains-description").value = "";

            AJS.dialog2("#event-domains-dialog").show();
        });

        function saveEventDomain() {
            var url = AJS.contextPath() + "/rest/event-plans/1.0/domain";

            jQuery.ajax({
                url: url,
                type: "PUT",
                contentType: "application/json",
                data:    '{ "name": "'        + AJS.$("#domains-name").attr("value") +
                        '", "description": "' + AJS.$("#domains-description").attr("value") + '" }',
                processData: false
            });

            // wstaw GET
        }

        AJS.$("#event-domains-dialog-save-button").click(function(e) {
            e.preventDefault();

            var domainName = document.getElementById("domains-name").value;

            if(domainName.valueOf() == "".valueOf()) {
                AJS.$('#domains-name-description').html('<div class="error" data-field="domains-name">You must specify a name of the event Domain.</div>');
            } else {
                // TODO Sprawdź czy obiekt Domain o tej nazwie już istnieje

                saveEventDomain();

                AJS.dialog2("#event-domains-dialog").hide();
                AJS.dialog2("#event-plan-dialog").show();
            }
        });

        AJS.$("#event-domains-dialog-cancel-button").click(function(e) {
            e.preventDefault();

            AJS.dialog2("#event-domains-dialog").hide();
            AJS.dialog2("#event-plan-dialog").show();
        });

         AJS.$("#add-component").click(function(e) {
            e.preventDefault();

            document.getElementById("component-name").value = "";
            document.getElementById("component-description").value = "";
            document.getElementById("component-tasks").value = "";

            AJS.dialog2("#event-component-dialog").show();
        });

        function saveEventComponent() {
            var url = AJS.contextPath() + "/rest/event-plans/1.0/component";

            jQuery.ajax({
                url: url,
                type: "PUT",
                contentType: "application/json",
                data:    '{ "name": "'        + AJS.$("#component-name").attr("value") +
                        '", "description": "' + AJS.$("#component-description").attr("value") +
                        '", "tasks": '        + JSON.stringify(AJS.$("#component-tasks").val()) + ' }',
                processData: false
            });

            // wstaw GET
        }

        AJS.$("#event-component-dialog-save-button").click(function(e) {
            e.preventDefault();

            var name = document.getElementById("component-name").value;
            var tasks = document.getElementById("component-tasks").value;

            if(name.valueOf() == "".valueOf()) {
                AJS.$('#component-name-description').html('<div class="error" data-field="component-name">You must specify a name of the event Component.</div>');
            }
            if(tasks.valueOf() == "".valueOf()) {
                AJS.$('#component-tasks-description').html('<div class="error" data-field="component-tasks">You must specify Tasks of which Component consists.</div>');
            }
            else {
                // TODO Sprawdź czy obiekt Component o tej nazwie już istnieje

                saveEventComponent();

                AJS.dialog2("#event-component-dialog").hide();
                AJS.dialog2("#event-plan-dialog").show();
            }
        });

        AJS.$("#event-component-dialog-cancel-button").click(function(e) {
            e.preventDefault();

            AJS.dialog2("#event-component-dialog").hide();
            AJS.dialog2("#event-plan-dialog").show();
        });

        AJS.$("#add-task").click(function(e) {
            e.preventDefault();

            document.getElementById("task-name").value = "";
            document.getElementById("task-description").value = "";
            document.getElementById("task-time").value = "";
            document.getElementById("task-subtasks").value = "";

            AJS.dialog2("#event-task-dialog").show();
        });

        function saveEventTask() {
            var url = AJS.contextPath() + "/rest/event-plans/1.0/task";

            jQuery.ajax({
                url: url,
                type: "PUT",
                contentType: "application/json",
                data:    '{ "name": "'        + AJS.$("#task-name").attr("value") +
                        '", "description": "' + AJS.$("#task-description").attr("value") +
                        '", "time": "'        + AJS.$("#task-time").attr("value") + '" }',
                processData: false
            });

            // wstaw GET
        }

        AJS.$("#event-task-dialog-save-button").click(function(e) {
            e.preventDefault();

            var name = document.getElementById("task-name").value;
            var time = document.getElementById("task-time").value;

            if(name.valueOf() == "".valueOf()) {
                AJS.$('#task-name-description').html('<div class="error" data-field="task-name">You must specify a name of the Task.</div>');
            }
            if(time.valueOf() == "".valueOf()) {
                AJS.$('#task-time-description').html('<div class="error" data-field="task-time">You must specify estimated time to complete Task.</div>');
            }
            else {
                // TODO Sprawdź czy obiekt Component o tej nazwie już istnieje

                saveEventTask();

                AJS.dialog2("#event-task-dialog").hide();
                AJS.dialog2("#event-plan-dialog").show();
            }
        });

        AJS.$("#event-task-dialog-cancel-button").click(function(e) {
            e.preventDefault();

            AJS.dialog2("#event-task-dialog").hide();
            AJS.dialog2("#event-plan-dialog").show();
        });

</script>
</body>
</html>
